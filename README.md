## Replication Package


This is the replication package for the paper: Using Network Flow Data and Machine Learning as Support for Mining Android Sandbox

### Abstract

As mobile technologies become part of modern society, Android’s dominance in the global smartphone market has made it
a prime target for cyberattacks. The Android platform faces a growing threat from malware, particularly repackaged apps that embed
malicious code to exploit user data. While sandbox-based approaches, such as Mining Android Sandbox (MAS), have been effective in
detecting repackaged malware by analyzing sensitive API interactions, they often fall short in identifying more complex threats. This
paper introduces a complementary approach that integrates network flow analysis with MAS approach to improve malware detection.
By analyzing the network traffic generated by Android applications, alongside behavioral data from MAS approach, this method
uncovers malicious activities that may remain hidden within the app’s behavior. Using machine learning on network traffic data
collected via TcpDump, combined with MAS approach insights, our method improves the accuracy of malware detection. Results
demonstrate that this combined approach significantly improves the identification of malware, offering a more comprehensive solution
for securing Android applications against evolving threats.

### Malware Dataset

At our work, we used a curated dataset of 4,076 app pairs (original/repackaged) from the study by Costa et al., which is available at CSV [file](https://github.com/droidxp/paper-droidxptrace-results/blob/main/TSE/large_ds.csv). Using this dataset, we utilized the [DroidXP](https://github.com/droidxp/benchmark) infrastructure for data collection. With DroidXP, we collected all PCAP files during the test executions, which were performed by the test generator tool, Droidbot, for 180 seconds for each app (a total of 5,887 apps). After this exploratory step, we leveraged [CICflowMeter](https://github.com/ahlashkari/CICFlowMeter) to extract the most relevant features from all the generated PCAP files for our study. The final result of this step is compiled into this [zip](https://unbbr-my.sharepoint.com/:u:/g/personal/180040723_aluno_unb_br/EQi-3p0Rg1xDtsUt7hwGTHABJaCwOB2DbbWDFjUrG5jZ8A?e=KWXkOu). Due to space limitations in the repository, this zip file is stored externally.

After the exploratory step, we combined the initial 76 features (excluding Destination Port and Hash) with 15 additional relevant destination ports, and applied 9 statistical functions using a Jupyter Notebook [script](https://github.com/droidxp/ML/blob/master/features_enge.ipynb) file. By the end of this process, we obtained a [dataset](https://unbbr-my.sharepoint.com/:x:/g/personal/180040723_aluno_unb_br/Eclh5qBUIblAvKj7EPU-RcMB7c4YfXF2ezKXiWh-gij5tw?e=5JBOs3) with a total of 10,262 features. To increase the efficiency of our models, we selected the 20 most relevant features based on Gini Importance or Mean Decrease in Impurity, using a Python [script](https://github.com/droidxp/ML/blob/master/clearFile.py). After this procedure, we obtained a [dataset](https://github.com/droidxp/ML/blob/master/cleaned_file.csv), containing the 20 most relevant features from all 4,076 app pairs (5,887 apps).

### Data Analysis

With this [dataset](https://github.com/droidxp/ML/blob/master/clearFile.py), we used various Python scripts to compute the metrics for different machine learning models, such as: Precision, recall, F1-score and AUC (Area Under Curve). Each script generated a respective CSV file containing the model predictions, as presented below:

+ [Random Forest](https://github.com/droidxp/ML/blob/master/DecisionTree.py). [CSV](https://github.com/droidxp/ML/blob/master/RandomForest.csv) file.
+ [Logistic Regression](https://github.com/droidxp/ML/blob/master/LogisticRegression.py). [CSV](https://github.com/droidxp/ML/blob/master/LogisticRegression.csv) file.
+ Liner Discriminant Analysis - [LDA](https://github.com/droidxp/ML/blob/master/Lda.py). [CSV](https://github.com/droidxp/ML/blob/master/Lda.csv) file.
+ Quadratic Discriminant Analysis - [QDA](https://github.com/droidxp/ML/blob/master/Qda.py). [CSV](https://github.com/droidxp/ML/blob/master/Qda.csv) file.
+ Energy Based Flow Classifier - [EFC](https://github.com/droidxp/ML/blob/master/efc.py). [CSV](https://github.com/droidxp/ML/blob/master/efc.csv) file.
